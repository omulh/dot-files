#! /bin/sh

# Get the volume and mute status for the default sink from pactl
defaultSinkVolume=$(pactl get-sink-volume @DEFAULT_SINK@ | sed -n '1p')
defaultSinkVolume=$(echo "$defaultSinkVolume" | sed -E 's/.*\s([0-9]+%).*/\1/; s/%//')
defaultSinkMute=$(pactl get-sink-mute @DEFAULT_SINK@)

# Get the 'node.nick' for the default sink from wpctl inspect,
# use 'device.description' if the audio sink has no 'node.nick'
wpctlOutput=$(wpctl inspect @DEFAULT_AUDIO_SINK@)
defaultSinkName=$(echo "$wpctlOutput" | grep node.nick | cut -d\" -f2)
if [[ -z $defaultSinkName ]]; then
    defaultSinkName=$(echo "$wpctlOutput" | grep 'node.description' | cut -d\" -f2)
fi

# Create the notification string
notificationStr="Vol: $defaultSinkVolume%"
[[ $defaultSinkMute == "Mute: yes" ]] && notificationStr+=" [Muted]"
notificationStr+="\n($defaultSinkName)"

# Send a notification
notify-send -u normal -h string:x-dunst-stack-tag:"hintNotification" \
    -h int:value:$defaultSinkVolume "hintNotification" "$notificationStr"
