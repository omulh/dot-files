#! /bin/sh

# Get the current volume for the default sink from pactl
defaultSinkVolume=$(pactl get-sink-volume @DEFAULT_SINK@ | sed -n '1p')
defaultSinkVolume=$(echo "$defaultSinkVolume" | sed -E 's/.*\s([0-9]+%).*/\1/; s/%//')

if [[ $1 == --increase || $1 == -i ]]; then
    if [[ $defaultSinkVolume -le 98 ]]; then
        pactl set-sink-volume @DEFAULT_SINK@ +2%
        # Get the new volume for the default sink from pactl
        defaultSinkVolume=$(pactl get-sink-volume @DEFAULT_SINK@ | sed -n '1p')
        defaultSinkVolume=$(echo "$defaultSinkVolume" | sed -E 's/.*\s([0-9]+%).*/\1/; s/%//')
    fi
elif [[ $1 == --decrease || $1 == -d ]]; then
    pactl set-sink-volume @DEFAULT_SINK@ -2%
    # Get the new volume for the default sink from pactl
    defaultSinkVolume=$(pactl get-sink-volume @DEFAULT_SINK@ | sed -n '1p')
    defaultSinkVolume=$(echo "$defaultSinkVolume" | sed -E 's/.*\s([0-9]+%).*/\1/; s/%//')
elif [[ $1 == --toggle-mute || $1 == -m ]]; then
    pactl set-sink-mute @DEFAULT_SINK@ toggle
fi

# Get the mute status for the default sink from pactl
defaultSinkMute=$(pactl get-sink-mute @DEFAULT_SINK@)

# Get the 'node.nick' for the default sink from wpctl inspect,
# use 'device.description' if the audio sink has no 'node.nick'
wpctlOutput=$(wpctl inspect @DEFAULT_AUDIO_SINK@)
defaultSinkName=$(echo "$wpctlOutput" | grep node.nick | cut -d\" -f2)
if [[ -z $defaultSinkName ]]; then
    defaultSinkName=$(echo "$wpctlOutput" | grep 'node.description' | cut -d\" -f2)
fi

# Create the notification string
notificationStr="Vol: $defaultSinkVolume%"
[[ $defaultSinkMute == "Mute: yes" ]] && notificationStr+=" [Muted]"
notificationStr+="\n($defaultSinkName)"

# Send a notification
notify-send -u normal -h string:x-dunst-stack-tag:"hintNotification" \
    -h int:value:$defaultSinkVolume "hintNotification" "$notificationStr"
