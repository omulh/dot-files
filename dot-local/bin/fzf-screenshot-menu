#! /bin/sh

# Count the number of enabled outputs
activeOutputCount=$(
    swaymsg -t get_outputs | \
    jq '[.[] | select(.power? and .active?)] | length'
)

# Set the menu options according to the number of enabled outputs
if [ $activeOutputCount -gt 1 ]; then
    options="All Outputs\nSelect an Output\n"
else
    options="Whole Screen\n"
fi
options+="\
Select a Window
Select a Region"

optionCount=$(echo -e "$options" | wc -l)

# Select an option with fzf
selection=$(
    echo -e "$options" | \
    fzf-popup-window 30x$((optionCount+4)) \
        --no-multi --no-input --margin 0,1,1 \
        --header '  Capture a Screenshot' \
        --header-border rounded \
)

case $selection in
    'All Outputs' | 'Whole Screen' )
        swaymsg exec screenshot-full ;;
    'Select an Output' )
        swaymsg exec screenshot-output ;;
    'Select a Window' )
        swaymsg exec screenshot-window ;;
    'Select a Region' )
        swaymsg exec screenshot-crop ;;
esac
