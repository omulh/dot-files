#! /bin/sh

if [[ $1 == --toggle-mute || $1 == -m ]]; then
    pactl set-source-mute @DEFAULT_SOURCE@ toggle
fi

# Get the mute status for the default source from pactl
defaultSourceMute=$(pactl get-source-mute @DEFAULT_SOURCE@)

# Get the 'node.nick' for the default source from wpctl inspect,
# use 'device.description' if the audio source has no 'node.nick'
wpctlOutput=$(wpctl inspect @DEFAULT_AUDIO_SOURCE@)
defaultSourceName=$(echo "$wpctlOutput" | grep node.nick | cut -d\" -f2)
if [[ -z $defaultSourceName ]]; then
    defaultSourceName=$(echo "$wpctlOutput" | grep 'node.description' | cut -d\" -f2)
fi

# Create the notification string and toggle the keyboard's mic. status LED
if [[ $defaultSourceMute == "Mute: yes" ]]; then
    brightnessctl -d platform::micmute -q s 1
    notificationStr="[Muted]"
else
    brightnessctl -d platform::micmute -q s 0
    notificationStr="[Active]"
fi
notificationStr+="\n($defaultSourceName)"

# Send a notification
notify-send -u normal -h string:x-dunst-stack-tag:"hintNotification" "hintNotification" "$notificationStr"
