#! /bin/sh

# Note: the script relies on an upstream Unicode emoji data file.
# Such file is available in the 'unicode-emoji' pacman package.

fileGeneratedEmojiData="$HOME"/.local/share/unicode/EmojiGeneratedData.txt
fileEmojiData="/usr/share/unicode/emoji/emoji-test.txt"

if [[ ! -f $fileEmojiData ]]; then
    echo "Aborting, Emoji data file not found ($fileEmojiData)" >&2
    exit 1
fi

# Only consider 'fully qualified' entries from the emoji-test file
emojiData=$(grep '^[^#].*fully-qualified' "$fileEmojiData")

# Split the data into codes, emojis and names
emojiDataCodes=$(
    echo "$emojiData" | \
    sed -E 's/^(.*[0-9A-F])\s+;.*/\1/ ; s/\</U+/g'
)
emojiDataEmojis=$(echo "$emojiData" | sed -E 's/.*# (.*) E.*/\1/')
emojiDataNames=$(echo "$emojiData" | sed 's/^.*E\S*\s//')

# Join the different data 'columns'.
emojiGeneratedData="$(
    paste -d '\t' \
        <(echo "$emojiDataCodes") \
        <(echo "$emojiDataEmojis") \
        <(echo "$emojiDataNames") \
)"

mkdir -p "${fileGeneratedEmojiData%/*}"
touch "$fileGeneratedEmojiData"
echo "$emojiGeneratedData" > "$fileGeneratedEmojiData"

echo "File successfully generated in $fileGeneratedEmojiData" >&2
